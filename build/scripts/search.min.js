const bindCardSlider=t=>!(!t||!t.classList.contains("swiper"))&&(Swiper?new Swiper(t,{pagination:{el:".swiper-pagination",clickable:!0}}):void 0),bindLikeBtn=(t,e)=>{if(!t||!e)return!1;const a=document.querySelector(".headerActions__btn_favorites"),r=t.closest(".item-card")&&t.closest(".item-card").querySelector(".js-item-card-cart"),c=r&&r.getAttribute("data-name")?r.getAttribute("data-name"):"",i=r&&r.getAttribute("data-img")?r.getAttribute("data-img"):"";t.addEventListener("click",(t=>{t.preventDefault(),t.target.classList.contains("item-card__like_liked")?fetch(`/ajax/favorites.php?id=${e}&delete=Y`).then((t=>t.json())).then((e=>{if(!e.success)throw new Error("Серверная ошибка удаления товара из понравившихся");t.target.classList.remove("item-card__like_liked"),void 0!==e.count&&a&&(isNaN(e.count)||a.setAttribute("data-count",String(e.count)));if(document.querySelector(".catalog_favorites")){const e=t.target.closest(".catalog__item");e&&e.remove()}})).catch((t=>{console.log(t)})):fetch(`/ajax/favorites.php?id=${e}`).then((t=>t.json())).then((e=>{if(!e.success)throw new Error("Серверная ошибка добавления товара в понравившиеся");t.target.classList.add("item-card__like_liked"),showAddItemModal("Товар добавлен в избранное",{name:c,img:i},"/favorites/","В избранное"),void 0!==e.count&&a&&(isNaN(e.count)||a.setAttribute("data-count",String(e.count)))})).catch((t=>{console.log(t)}))}))},bindCompareBtn=(t,e)=>{if(!t||!e)return!1;const a=document.querySelector(".headerActions__btn_compare"),r=t.closest(".item-card")&&t.closest(".item-card").querySelector(".js-item-card-cart"),c=r&&r.getAttribute("data-name")?r.getAttribute("data-name"):"",i=r&&r.getAttribute("data-img")?r.getAttribute("data-img"):"";t.addEventListener("click",(t=>{t.preventDefault(),t.target.classList.contains("item-card__compare_compared")?fetch(`/ajax/compare.php?id=${e}&delete=Y`).then((t=>t.json())).then((e=>{if(!e.success)throw new Error("Серверная ошибка удаления товара из сравнения");t.target.classList.remove("item-card__compare_compared"),void 0!==e.count&&a&&!isNaN(e.count)&&a.setAttribute("data-count",String(e.count))})).catch((t=>{console.log(t)})):fetch(`/ajax/compare.php?id=${e}`).then((t=>t.json())).then((e=>{if(!e.success)throw new Error("Серверная ошибка добавления товара в сравнение");t.target.classList.add("item-card__compare_compared"),showAddItemModal("Товар добавлен в сравнение",{name:c,img:i},"/compare/","В сравнение"),void 0!==e.count&&a&&!isNaN(e.count)&&a.setAttribute("data-count",String(e.count))})).catch((t=>{console.log(t)}))}))},bindCartBtn=(t,e,a)=>{if(!t||!e)return!1;const r=document.querySelector(".headerActions__btn_basket");t.addEventListener("click",(a=>{a.preventDefault();let c=t.getAttribute("data-name"),i=t.getAttribute("data-img");a.target.classList.contains("item-card__cart_in-cart")?fetch(`/ajax/basket.php?id=${e}&delete=Y`).then((t=>t.json())).then((t=>{if(!t.success)throw new Error("Серверная ошибка удаления товара из корзины");a.target.classList.remove("item-card__cart_in-cart"),void 0!==t.count&&r&&(isNaN(t.count)||r.setAttribute("data-count",String(t.count)))})).catch((t=>{console.log(t)})):fetch(`/ajax/basket.php?id=${e}&count=1&json=1`).then((t=>t.json())).then((t=>{if(!t.success)throw new Error("Серверная ошибка добавления товара в корзину");a.target.classList.add("item-card__cart_in-cart"),showAddItemModal("Товар добавлен в корзину",{name:c,img:i},"/basket/","В корзину"),void 0!==t.count&&r&&(isNaN(t.count)||r.setAttribute("data-count",String(t.count)))})).catch((t=>{console.log(t)}))}))},bindItemCard=t=>{if(!t)return!1;const e=t.getAttribute("data-item-id");let a;bindCardSlider(t.querySelector(".swiper")),bindLikeBtn(t.querySelector(".js-item-card-like"),e),bindCompareBtn(t.querySelector(".js-item-card-compare"),e),a=t.classList.contains("card")?document.querySelector(".page-title_card h1").innerText:t.querySelector(".item-card__name").innerText;for(const a of t.querySelectorAll(".js-item-card-cart"))bindCartBtn(a,e)},bindSearchTabs=t=>{if(!t)return!1;[...t.querySelectorAll(".search-page__toggle")].map((e=>{e.addEventListener("click",(a=>{a.preventDefault(),t.querySelector(".search-page__toggle_active")&&t.querySelector(".search-page__toggle_active").classList.remove("search-page__toggle_active"),e.classList.add("search-page__toggle_active"),t.querySelector(".search-page__results_active")&&t.querySelector(".search-page__results_active").classList.remove("search-page__results_active"),t.querySelector(e.getAttribute("href")).classList.add("search-page__results_active")}))}))};window.addEventListener("DOMContentLoaded",(()=>{bindSearchTabs(document.querySelector(".search-page"));for(const t of document.querySelectorAll(".item-card"))bindItemCard(t)}));