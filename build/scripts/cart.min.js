const bindAddressToggle=(e,t,r)=>{if(!e||!r||!t)return!1;const c=r.querySelector("input");if(!c)return!1;e.addEventListener("change",(e=>{e.target.checked&&(r.classList.remove("form__item_hidden"),c.setAttribute("required","required"))})),t.addEventListener("change",(e=>{e.target.checked&&(r.classList.add("form__item_hidden"),c.removeAttribute("required"))}))},bindItemCounter=e=>{if(!e)return!1;const t=e.querySelector(".cart-table__item-count input"),r=e.querySelector('.cart-table__item-count button[data-action="increment"]'),c=e.querySelector('.cart-table__item-count button[data-action="decrement"]');if(!t||!r||!c)return!1;r.addEventListener("click",(r=>{r.preventDefault();const c=Number(t.value);if(isNaN(c))return t.value="1",!0;t.value=String(c+1),countItemSumPrice(e)})),c.addEventListener("click",(r=>{r.preventDefault();const c=Number(t.value);if(1===c||isNaN(c))return t.value="1",!0;t.value=String(c-1),countItemSumPrice(e)}))},calcOverall=()=>{const e=document.querySelector(".cart-table__summary-value");if(!e)return!1;const t=[...document.querySelectorAll(".cart-table__item-sum")].map((e=>Number(e.innerText.replace(/\D/g,"")))).reduce(((e,t)=>"number"==typeof t?e+t:e),0);e.innerText=new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB",maximumFractionDigits:0}).format(t)},countItemSumPrice=(e,t)=>{if(!e)return!1;let r,c,n;const a=e.querySelector(".cart-table__item-price span");a?c=Number(a.innerText.replace(/\D/g,"")):r="По запросу",c&&!isNaN(c)||(r="По запросу");const o=e.querySelector(".cart-table__item-count input");o?n=Number(o.value):r="По запросу",n&&!isNaN(n)||(r="По запросу"),r||(r=new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB",maximumFractionDigits:0}).format(c*n));const i=e.querySelector(".cart-table__item-sum");i&&(i.innerText=r),t||calcOverall()},checkEmpty=()=>{const e=document.querySelector(".cart__table-wrapper");if(!e)return!1;if(!document.querySelectorAll(".cart-table__item").length){e.querySelector(".cart-table").style.display="none";const t=document.createElement("div");t.classList.add("cart__empty"),t.innerHTML='В корзине пусто. <a href="/catalog/">Перейти в каталог</a>.',e.append(t)}},bindDeleteItem=e=>{if(!e)return!1;const t=e.querySelector(".cart-table__item-del"),r=e.getAttribute("data-item-id");t.addEventListener("click",(t=>{t.preventDefault(),fetch("path/to/delete/item",{method:"POST",body:JSON.stringify({itemId:r})}).then((e=>e.json())).then((({status:t})=>{if("success"!==t)throw new Error;e.remove(),calcOverall(),checkEmpty()})).catch((e=>{Fancybox.show([{src:'<div class="modal-cart-confirmation">\n<div>Ошибка удаления товара из корзины. Вы можете оформить заказ и отредактировать его содержимое, когда наш менеджер свяжется с Вами.</div>\n<div class="modal-cart-confirmation__buttons">\n<a onclick="window.location.reload()">Обновить страницу</a>\n<div class="is-close-btn" onclick="Fancybox.close()">Продолжить</div>\n</div>\n</div>',type:"html"}])})),e.remove(),calcOverall(),checkEmpty()}))},clearCart=()=>{for(const e of document.querySelectorAll(".cart-table__item"))e.remove();checkEmpty()},bindCartItem=e=>{if(!e)return!1;countItemSumPrice(e,!0),bindItemCounter(e),calcOverall(),bindDeleteItem(e)},collectItemsData=()=>{const e=[...document.querySelectorAll(".cart-table__item")];return e.length?e.reduce(((e,t)=>[...e,{id:t.getAttribute("data-item-id"),name:t.querySelector(".cart-table__item-name").innerText,count:t.querySelector(".cart-table__item-count input").value}]),[]):[]},collectData=e=>({...[...e.querySelectorAll('input:not([type="submit"])')].reduce(((e,t)=>"radio"===t.getAttribute("type")?t.checked?{...e,[t.getAttribute("name")]:t.value}:e:{...e,[t.getAttribute("name")]:t.value}),{}),items:collectItemsData()}),bindCartForm=e=>{if(!e)return!1;e.addEventListener("submit",(t=>{t.preventDefault(),console.log(collectData(e)),fetch("path",{method:"POST",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify(collectData(e))}).then((e=>e.json())).then((({status:t,number:r,mail:c})=>{if("success"!==t)throw new Error;Fancybox.show([{src:`<div class="modal-cart-confirmation">\n<div class="modal-cart-confirmation__text">Оформлен заказ №${r}. Детали заказа отправлены на электронную почту ${c}. В ближайшее время наш менеджер свяжется с Вами.</div>\n<div class="modal-cart-confirmation__buttons">\n<a href="/catalog/">Перейти в каталог</a>\n</div>\n</div>`,type:"html"}]),e.reset(),clearCart()})).catch((()=>{Fancybox.show([{src:'<div class="modal-cart-confirmation">\n<div class="modal-cart-confirmation__text">Произошла ошибка при оформлении заказа.<br>Попробуйте еще раз, или свяжитесь с нами по телефону <a href="tel:+74959882028">+7(495) 988-20-28</a></div>\n<div class="modal-cart-confirmation__buttons">\n<a onclick="window.location.reload()">Обновить страницу</a>\n<div class="is-close-btn" onclick="Fancybox.close()">Продолжить</div>\n</div>\n</div>',type:"html"}])}))}))};window.addEventListener("DOMContentLoaded",(()=>{bindAddressToggle(document.querySelector(".js-address-radio"),document.querySelector(".js-stock-radio"),document.querySelector(".js-address-field"));for(const e of document.querySelectorAll(".cart-table__item"))bindCartItem(e);checkEmpty(),bindCartForm(document.querySelector(".js-cart-form"));for(const e of document.querySelectorAll('input[type="tel"]'))Inputmask&&Inputmask({mask:["+7 999 999-99-99","8 999 999-99-99"],showMaskOnHover:!1}).mask(e)}));
//# sourceMappingURL=cart.min.js.map
