const collapseChildItems=function(e,t){if(!e)return!1;const i=document.querySelectorAll(e+":not(.collapseElement)");console.log(i);const n={children:t.children||"*",targetHeight:t.targetHeight||null,targetCount:t.targetCount||null,reduceHeight:t.reduceHeight||0,buttonClass:t.buttonClass||"",buttonMore:t.buttonMore||"Смотреть еще",buttonLess:t.buttonLess||"Скрыть"};if(!i[0])return!1;for(let e=0;e<i.length;e++){const t=i[e];null!==n.targetHeight?(r(t),c(t,"height")):null!==n.targetCount&&(o(t),c(t,"count"))}function r(e){e.offsetHeight>n.targetHeight&&(a(e,"collapseElement_height"),e.querySelector("[data-collapse-element-wrap]").style.height=n.targetHeight-n.reduceHeight+"px")}function o(e){if(e.querySelectorAll(n.children).length>n.targetCount){a(e);const t=e.querySelectorAll(n.children);for(let e=0;e<t.length;e++)e+1>n.targetCount&&t[e].classList.add("collapseElement__hidden")}}function a(e,t){e.classList.add("collapseElement","collapseElement_hide"),t&&e.classList.add(t),e.innerHTML=function(e){const t='<div class="collapseElement__content" data-collapse-element-content>'+e.innerHTML+"</div>",i='<button class="collapseElement__button '+n.buttonClass+'" type="button" data-collapse-element-button><span>'+n.buttonMore+"</span><span>"+n.buttonLess+"</span></button>";return'<div class="collapseElement__wrap" data-collapse-element-wrap>'+t+"</div>"+i}(e)}function c(e,t){const i=e.querySelector("[data-collapse-element-button]");i&&i.addEventListener("click",(function(i){if(i.preventDefault(),e.classList.contains("collapseElement_hide")){if(e.classList.remove("collapseElement_hide"),"height"===t){const t=e.querySelector("[data-collapse-element-wrap]"),i=e.querySelector("[data-collapse-element-content]").offsetHeight;t.style.height=i+"px",setTimeout((function(){t.style.height="auto"}),200)}}else if(e.classList.add("collapseElement_hide"),"height"===t){const t=e.querySelector("[data-collapse-element-wrap]"),i=t.offsetHeight;t.style.height=i+"px",setTimeout((function(){t.style.height=n.targetHeight-n.reduceHeight+"px"}),0)}}))}},bindCardSlider=e=>!(!e||!e.classList.contains("swiper"))&&(Swiper?new Swiper(e,{pagination:{el:".swiper-pagination",clickable:!0}}):void 0),bindLikeBtn=(e,t)=>{if(!e||!t)return!1;const i=document.querySelector(".headerActions__btn_favorites"),n=e.closest(".item-card")&&e.closest(".item-card").querySelector(".js-item-card-cart"),r=n&&n.getAttribute("data-name")?n.getAttribute("data-name"):"",o=n&&n.getAttribute("data-img")?n.getAttribute("data-img"):"";e.addEventListener("click",(e=>{e.preventDefault(),e.target.classList.contains("item-card__like_liked")?fetch(`/ajax/favorites.php?id=${t}&delete=Y`).then((e=>e.json())).then((t=>{if(!t.success)throw new Error("Серверная ошибка удаления товара из понравившихся");e.target.classList.remove("item-card__like_liked"),void 0!==t.count&&i&&(isNaN(t.count)||i.setAttribute("data-count",String(t.count)));if(document.querySelector(".catalog_favorites")){const t=e.target.closest(".catalog__item");t&&t.remove()}})).catch((e=>{console.log(e)})):fetch(`/ajax/favorites.php?id=${t}`).then((e=>e.json())).then((t=>{if(!t.success)throw new Error("Серверная ошибка добавления товара в понравившиеся");e.target.classList.add("item-card__like_liked"),showAddItemModal("Товар добавлен в избранное",{name:r,img:o},"/favorites/","В избранное"),void 0!==t.count&&i&&(isNaN(t.count)||i.setAttribute("data-count",String(t.count)))})).catch((e=>{console.log(e)}))}))},bindCompareBtn=(e,t)=>{if(!e||!t)return!1;const i=document.querySelector(".headerActions__btn_compare"),n=e.closest(".item-card")&&e.closest(".item-card").querySelector(".js-item-card-cart"),r=n&&n.getAttribute("data-name")?n.getAttribute("data-name"):"",o=n&&n.getAttribute("data-img")?n.getAttribute("data-img"):"";e.addEventListener("click",(e=>{e.preventDefault(),e.target.classList.contains("item-card__compare_compared")?fetch(`/ajax/compare.php?id=${t}&delete=Y`).then((e=>e.json())).then((t=>{if(!t.success)throw new Error("Серверная ошибка удаления товара из сравнения");e.target.classList.remove("item-card__compare_compared"),void 0!==t.count&&i&&!isNaN(t.count)&&i.setAttribute("data-count",String(t.count))})).catch((e=>{console.log(e)})):fetch(`/ajax/compare.php?id=${t}`).then((e=>e.json())).then((t=>{if(!t.success)throw new Error("Серверная ошибка добавления товара в сравнение");e.target.classList.add("item-card__compare_compared"),showAddItemModal("Товар добавлен в сравнение",{name:r,img:o},"/compare/","В сравнение"),void 0!==t.count&&i&&!isNaN(t.count)&&i.setAttribute("data-count",String(t.count))})).catch((e=>{console.log(e)}))}))},bindCartBtn=(e,t,i)=>{if(!e||!t)return!1;const n=document.querySelector(".headerActions__btn_basket");e.addEventListener("click",(i=>{i.preventDefault();let r=e.getAttribute("data-name"),o=e.getAttribute("data-img");i.target.classList.contains("item-card__cart_in-cart")?fetch(`/ajax/basket.php?id=${t}&delete=Y`).then((e=>e.json())).then((e=>{if(!e.success)throw new Error("Серверная ошибка удаления товара из корзины");i.target.classList.remove("item-card__cart_in-cart"),void 0!==e.count&&n&&(isNaN(e.count)||n.setAttribute("data-count",String(e.count)))})).catch((e=>{console.log(e)})):fetch(`/ajax/basket.php?id=${t}&count=1&json=1`).then((e=>e.json())).then((e=>{if(!e.success)throw new Error("Серверная ошибка добавления товара в корзину");i.target.classList.add("item-card__cart_in-cart"),showAddItemModal("Товар добавлен в корзину",{name:r,img:o},"/basket/","В корзину"),void 0!==e.count&&n&&(isNaN(e.count)||n.setAttribute("data-count",String(e.count)))})).catch((e=>{console.log(e)}))}))},bindItemCard=e=>{if(!e)return!1;const t=e.getAttribute("data-item-id");let i;bindCardSlider(e.querySelector(".swiper")),bindLikeBtn(e.querySelector(".js-item-card-like"),t),bindCompareBtn(e.querySelector(".js-item-card-compare"),t),i=e.classList.contains("card")?document.querySelector(".page-title_card h1").innerText:e.querySelector(".item-card__name").innerText;for(const i of e.querySelectorAll(".js-item-card-cart"))bindCartBtn(i,t)},itemsSlider=e=>!!e&&(Swiper?new Swiper(e.querySelector(".swiper"),{slidesPerView:8,spaceBetween:20,breakpoints:{1730:{slidesPerView:8},1560:{slidesPerView:7},1360:{slidesPerView:6},1100:{slidesPerView:5},851:{slidesPerView:4},641:{slidesPerView:3},351:{slidesPerView:2},0:{slidesPerView:1}}}):void 0),bindPerPageSelect=e=>{if(!e||!NiceSelect)return!1;NiceSelect.bind(e)},bindSortSelect=e=>{if(!e||!NiceSelect)return!1;NiceSelect.bind(e),e.addEventListener("change",(e=>{const t=new URLSearchParams(window.location.search);t.set(e.target.getAttribute("name"),e.target.value),t.toString(),localStorage.setItem("scrollToCatalog","1"),window.location=window.location.pathname+"?"+t.toString()}))},bindFilterShowButton=e=>{if(!e)return!1;if(!e.querySelectorAll(".filter__checkbox"))return!1;const t=e.querySelector(".filter__show-more");if(!t)return!1;const i=t.innerHTML;t.addEventListener("click",(n=>{n.preventDefault(),e.classList.toggle("filter_show-all"),"свернуть"===t.innerHTML.toLowerCase()?t.innerHTML=i:t.innerHTML="Свернуть"}))},scrollToCatalog=()=>{const e=localStorage.getItem("scrollToCatalog"),t=document.querySelector(".catalog-layout");e&&t&&(t.scrollIntoView({behavior:"smooth"}),localStorage.removeItem("scrollToCatalog"))},bindFilterPrice=e=>{if(!e)return!1;const t=e.querySelector(".filter__price-slider");if(!t||!noUiSlider)return!1;noUiSlider.create(t,{start:[Number(t.getAttribute("data-min"))||0,Number(t.getAttribute("data-max"))||5e5],connect:!0,step:100,range:{min:Number(t.getAttribute("data-min"))||0,max:Number(t.getAttribute("data-max"))||5e5}});const i=e.querySelector('[name="price_from"]'),n=e.querySelector('[name="price_to"]');t.noUiSlider.on("update",(function(e,t){const r=e[t];t?n.value=Math.round(r):i.value=Math.round(r)})),i.addEventListener("change",(function(){t.noUiSlider.set([this.value,null])})),n.addEventListener("change",(function(){t.noUiSlider.set([null,this.value])}))},bindSectionsListAdaptive=e=>{if(!e)return!1;if(window.matchMedia("(max-width: 750px)").matches&&window.ADAPTIVE_SUBSECTIONS_FLAG)return!1;if(window.matchMedia("(min-width: 751px)").matches&&!window.ADAPTIVE_SUBSECTIONS_FLAG)return!1;if(window.matchMedia("(max-width: 750px)").matches&&!window.ADAPTIVE_SUBSECTIONS_FLAG){window.ADAPTIVE_SUBSECTIONS_FLAG=!0;const t=document.createElement("div");t.classList.add("sections-list-select");const i=e.querySelector("ul"),n=i.querySelector(".sections-list__item_active");n||(t.innerText="Выбрать раздел каталога"),n&&(t.append(n.cloneNode(!0)),t.querySelector("a").addEventListener("click",(e=>{e.preventDefault()})));const r=document.createElement("li");r.setAttribute("type","button"),r.classList.add("sections-list__close-btn"),i.append(r),e.after(t),t.addEventListener("click",(t=>{e.classList.toggle("sections-list_opened")})),e.addEventListener("click",(t=>{e!==t.target&&r!==t.target||e.classList.remove("sections-list_opened")}))}window.matchMedia("(min-width: 751px)").matches&&window.ADAPTIVE_SUBSECTIONS_FLAG&&(window.ADAPTIVE_SUBSECTIONS_FLAG=!1,document.querySelector(".sections-list-select")&&document.querySelector(".sections-list-select").remove())},bindFiltersAdaptive=()=>{const e=document.querySelector(".sort__filters-adaptive"),t=document.querySelector(".catalog-layout__sidebar");if(!t&&e)return e.style.display="none",!1;if(!t||!e)return!1;const i=n=>n?n.target!==e&&(n.target!==t&&!t.contains(n.target)&&(t.classList.remove("catalog-layout__sidebar_opened"),void document.removeEventListener("click",i))):(t.classList.remove("catalog-layout__sidebar_opened"),document.removeEventListener("click",i),!0);e.addEventListener("click",(e=>{e.preventDefault(),t.classList.contains("catalog-layout__sidebar_opened")?i():(t.classList.add("catalog-layout__sidebar_opened"),document.addEventListener("click",i))})),t.querySelector(".catalog-layout__sidebar-close").addEventListener("click",(e=>{e.preventDefault(),i()})),t.querySelector(".filters__actions button").addEventListener("click",(()=>{i()}))},bindFilterChange=e=>{if(!e)return!1;const t=[...e.querySelectorAll("input")],i=e.querySelector(".filters__actions button");t.map((e=>{e.addEventListener("change",(()=>{i.style.visibility="visible",i.style.opacity="1"}))})),i.addEventListener("click",(e=>{e.preventDefault(),i.style.visibility="hidden",i.style.opacity="0"}))};window.addEventListener("DOMContentLoaded",(()=>{for(const e of document.querySelectorAll(".item-card"))bindItemCard(e);for(const e of document.querySelectorAll(".items-slider"))itemsSlider(e);for(const e of document.querySelectorAll(".sort__item select"))bindSortSelect(e);scrollToCatalog();for(const e of document.querySelectorAll(".filter"))bindFilterShowButton(e);for(const e of document.querySelectorAll(".filter__price"))bindFilterPrice(e);bindSectionsListAdaptive(document.querySelector(".sections-list")),bindFiltersAdaptive(),bindFilterChange(document.querySelector(".filters")),collapseChildItems(".js-collapsible-text",{targetHeight:150,buttonMore:"Развернуть",buttonLess:"Свернуть"})})),window.addEventListener("resize",(()=>{bindSectionsListAdaptive(document.querySelector(".sections-list"))}));
//# sourceMappingURL=catalog.min.js.map
