const bindCardSlider=e=>!(!e||!e.classList.contains("swiper"))&&(Swiper?new Swiper(e,{pagination:{el:".swiper-pagination",clickable:!0}}):void 0),bindLikeBtn=(e,t)=>{if(!e||!t)return!1;e.addEventListener("click",(e=>{e.preventDefault(),e.target.classList.contains("item-card__like_liked")?fetch("/somepath/"+t).then((e=>e.json())).then((t=>{if("success"!==t.status)throw new Error("Серверная ошибка удаления товара из понравившихся");e.target.classList.remove("item-card__like_liked")})).catch((e=>{console.log(e)})):fetch("/somepath/"+t).then((e=>e.json())).then((t=>{if("success"!==t.status)throw new Error("Серверная ошибка добавления товара в понравившиеся");e.target.classList.add("item-card__like_liked")})).catch((e=>{console.log(e)}))}))},bindCompareBtn=(e,t)=>{if(!e||!t)return!1;e.addEventListener("click",(e=>{e.preventDefault(),e.target.classList.contains("item-card__compare_compared")?fetch("/somepath/"+t).then((e=>e.json())).then((t=>{if("success"!==t.status)throw new Error("Серверная ошибка удаления товара из сравнения");e.target.classList.remove("item-card__compare_compared")})).catch((e=>{console.log(e)})):fetch("/somepath/"+t).then((e=>e.json())).then((t=>{if("success"!==t.status)throw new Error("Серверная ошибка добавления товара в сравнение");e.target.classList.add("item-card__compare_compared")})).catch((e=>{console.log(e)}))}))},bindCartBtn=(e,t,r)=>{if(!e||!t)return!1;e.addEventListener("click",(e=>{e.preventDefault(),e.target.classList.contains("item-card__cart_in-cart")?fetch("/somepath/"+t).then((e=>e.json())).then((t=>{if("success"!==t.status)throw new Error("Серверная ошибка удаления товара из корзины");e.target.classList.remove("item-card__cart_in-cart")})).catch((e=>{console.log(e)})):(Fancybox.show([{src:`<div class="modal-cart-confirmation">\n<div>Товар <b>"${r}"</b> добавлен в корзину.</div>\n<div class="modal-cart-confirmation__buttons">\n<a href="/cart/">Перейти в корзину</a>\n<div class="is-close-btn" onclick="Fancybox.close()">Продолжить покупки</div>\n</div>\n</div>`,type:"html"}]),fetch("/somepath/"+t).then((e=>e.json())).then((t=>{if("success"!==t.status)throw new Error("Серверная ошибка добавления товара в корзину");e.target.classList.add("item-card__cart_in-cart")})).catch((e=>{console.log(e)})))}))},bindItemCard=e=>{if(!e)return!1;const t=e.getAttribute("data-item-id");bindCardSlider(e.querySelector(".swiper")),bindLikeBtn(e.querySelector(".js-item-card-like"),t),bindCompareBtn(e.querySelector(".js-item-card-compare"),t);const r=e.querySelector(".item-card__name").innerText;for(const o of e.querySelectorAll(".js-item-card-cart"))bindCartBtn(o,t,r)},itemsSlider=e=>!!e&&(Swiper?new Swiper(e.querySelector(".swiper"),{slidesPerView:5,spaceBetween:50}):void 0),bindPerPageSelect=e=>{if(!e||!NiceSelect)return!1;NiceSelect.bind(e)},bindSortSelect=e=>{if(!e||!NiceSelect)return!1;NiceSelect.bind(e),e.addEventListener("change",(e=>{const t=new URLSearchParams(window.location.search);t.set(e.target.getAttribute("name"),e.target.value),t.toString(),localStorage.setItem("scrollToCatalog","1"),window.location=window.location.pathname+"?"+t.toString()}))},bindFilterShowButton=e=>{if(!e)return!1;if(!e.querySelectorAll(".filter__checkbox"))return!1;const t=e.querySelector(".filter__show-more");if(!t)return!1;const r=t.innerHTML;t.addEventListener("click",(o=>{o.preventDefault(),e.classList.toggle("filter_show-all"),"свернуть"===t.innerHTML.toLowerCase()?t.innerHTML=r:t.innerHTML="Свернуть"}))},scrollToCatalog=()=>{const e=localStorage.getItem("scrollToCatalog"),t=document.querySelector(".catalog-layout");e&&t&&(t.scrollIntoView({behavior:"smooth"}),localStorage.removeItem("scrollToCatalog"))},bindFilterPrice=e=>{if(!e)return!1;const t=e.querySelector(".filter__price-slider");if(!t||!noUiSlider)return!1;noUiSlider.create(t,{start:[Number(t.getAttribute("data-min"))||0,Number(t.getAttribute("data-max"))||5e5],connect:!0,step:100,range:{min:Number(t.getAttribute("data-min"))||0,max:Number(t.getAttribute("data-max"))||5e5}});const r=e.querySelector('[name="price_from"]'),o=e.querySelector('[name="price_to"]');t.noUiSlider.on("update",(function(e,t){const n=e[t];t?o.value=Math.round(n):r.value=Math.round(n)})),r.addEventListener("change",(function(){t.noUiSlider.set([this.value,null])})),o.addEventListener("change",(function(){t.noUiSlider.set([null,this.value])}))};window.addEventListener("DOMContentLoaded",(()=>{for(const e of document.querySelectorAll(".item-card"))bindItemCard(e);for(const e of document.querySelectorAll(".items-slider"))itemsSlider(e);for(const e of document.querySelectorAll(".sort__item select"))bindSortSelect(e);scrollToCatalog();for(const e of document.querySelectorAll(".filter"))bindFilterShowButton(e);for(const e of document.querySelectorAll(".filter__price"))bindFilterPrice(e)}));