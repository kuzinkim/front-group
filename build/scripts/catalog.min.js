const collapseChildItems=function(e,t){if(!e)return!1;const n=document.querySelectorAll(e+":not(.collapseElement)");console.log(n);const i={children:t.children||"*",targetHeight:t.targetHeight||null,targetCount:t.targetCount||null,reduceHeight:t.reduceHeight||0,buttonClass:t.buttonClass||"",buttonMore:t.buttonMore||"Смотреть еще",buttonLess:t.buttonLess||"Скрыть"};if(!n[0])return!1;for(let e=0;e<n.length;e++){const t=n[e];null!==i.targetHeight?(o(t),a(t,"height")):null!==i.targetCount&&(r(t),a(t,"count"))}function o(e){e.offsetHeight>i.targetHeight&&(c(e,"collapseElement_height"),e.querySelector("[data-collapse-element-wrap]").style.height=i.targetHeight-i.reduceHeight+"px")}function r(e){if(e.querySelectorAll(i.children).length>i.targetCount){c(e);const t=e.querySelectorAll(i.children);for(let e=0;e<t.length;e++)e+1>i.targetCount&&t[e].classList.add("collapseElement__hidden")}}function c(e,t){e.classList.add("collapseElement","collapseElement_hide"),t&&e.classList.add(t),e.innerHTML=function(e){const t='<div class="collapseElement__content" data-collapse-element-content>'+e.innerHTML+"</div>",n='<button class="collapseElement__button '+i.buttonClass+'" type="button" data-collapse-element-button><span>'+i.buttonMore+"</span><span>"+i.buttonLess+"</span></button>";return'<div class="collapseElement__wrap" data-collapse-element-wrap>'+t+"</div>"+n}(e)}function a(e,t){const n=e.querySelector("[data-collapse-element-button]");n&&n.addEventListener("click",(function(n){if(n.preventDefault(),e.classList.contains("collapseElement_hide")){if(e.classList.remove("collapseElement_hide"),"height"===t){const t=e.querySelector("[data-collapse-element-wrap]"),n=e.querySelector("[data-collapse-element-content]").offsetHeight;t.style.height=n+"px",setTimeout((function(){t.style.height="auto"}),200)}}else if(e.classList.add("collapseElement_hide"),"height"===t){const t=e.querySelector("[data-collapse-element-wrap]"),n=t.offsetHeight;t.style.height=n+"px",setTimeout((function(){t.style.height=i.targetHeight-i.reduceHeight+"px"}),0)}}))}},bindCardSlider=e=>!(!e||!e.classList.contains("swiper"))&&(Swiper?new Swiper(e,{pagination:{el:".swiper-pagination",clickable:!0}}):void 0),bindLikeBtn=(e,t)=>{if(!e||!t)return!1;const n=document.querySelector(".headerActions__btn_favorites");e.addEventListener("click",(e=>{e.preventDefault(),e.target.classList.contains("item-card__like_liked")?fetch(`/ajax/favorites.php?id=${t}&delete=Y`).then((e=>e.json())).then((t=>{if(!t.success)throw new Error("Серверная ошибка удаления товара из понравившихся");e.target.classList.remove("item-card__like_liked"),void 0!==t.count&&n&&(isNaN(t.count)||n.setAttribute("data-count",String(t.count)));if(document.querySelector(".catalog_favorites")){const t=e.target.closest(".catalog__item");t&&t.remove()}})).catch((e=>{console.log(e)})):fetch(`/ajax/favorites.php?id=${t}`).then((e=>e.json())).then((t=>{if(!t.success)throw new Error("Серверная ошибка добавления товара в понравившиеся");e.target.classList.add("item-card__like_liked"),void 0!==t.count&&n&&(isNaN(t.count)||n.setAttribute("data-count",String(t.count)))})).catch((e=>{console.log(e)}))}))},bindCompareBtn=(e,t)=>{if(!e||!t)return!1;const n=document.querySelector(".headerActions__btn_compare");e.addEventListener("click",(e=>{e.preventDefault(),e.target.classList.contains("item-card__compare_compared")?fetch(`/ajax/compare.php?id=${t}&delete=Y`).then((e=>e.json())).then((t=>{if(!t.success)throw new Error("Серверная ошибка удаления товара из сравнения");e.target.classList.remove("item-card__compare_compared"),void 0!==t.count&&n&&!isNaN(t.count)&&n.setAttribute("data-count",String(t.count))})).catch((e=>{console.log(e)})):fetch(`/ajax/compare.php?id=${t}`).then((e=>e.json())).then((t=>{if(!t.success)throw new Error("Серверная ошибка добавления товара в сравнение");e.target.classList.add("item-card__compare_compared"),void 0!==t.count&&n&&!isNaN(t.count)&&n.setAttribute("data-count",String(t.count))})).catch((e=>{console.log(e)}))}))},bindCartBtn=(e,t,n)=>{if(!e||!t)return!1;const i=document.querySelector(".headerActions__btn_basket");e.addEventListener("click",(e=>{e.preventDefault(),e.target.classList.contains("item-card__cart_in-cart")?fetch(`/ajax/basket.php?id=${t}&delete=Y`).then((e=>e.json())).then((t=>{if(!t.success)throw new Error("Серверная ошибка удаления товара из корзины");e.target.classList.remove("item-card__cart_in-cart"),void 0!==t.count&&i&&(isNaN(t.count)||i.setAttribute("data-count",String(t.count)))})).catch((e=>{console.log(e)})):fetch(`/ajax/basket.php?id=${t}&count=1&json=1`).then((e=>e.json())).then((t=>{if(!t.success)throw new Error("Серверная ошибка добавления товара в корзину");e.target.classList.add("item-card__cart_in-cart"),Fancybox.show([{src:`<div class="modal-cart-confirmation">\n<div>Товар <b>"${n}"</b> добавлен в корзину.</div>\n<div class="modal-cart-confirmation__buttons">\n<a href="/basket/">Перейти в корзину</a>\n<div class="is-close-btn" onclick="Fancybox.close()">Продолжить покупки</div>\n</div>\n</div>`,type:"html"}]),void 0!==t.count&&i&&(isNaN(t.count)||i.setAttribute("data-count",String(t.count)))})).catch((e=>{console.log(e)}))}))},bindItemCard=e=>{if(!e)return!1;const t=e.getAttribute("data-item-id");let n;bindCardSlider(e.querySelector(".swiper")),bindLikeBtn(e.querySelector(".js-item-card-like"),t),bindCompareBtn(e.querySelector(".js-item-card-compare"),t),n=e.classList.contains("card")?document.querySelector(".page-title_card h1").innerText:e.querySelector(".item-card__name").innerText;for(const i of e.querySelectorAll(".js-item-card-cart"))bindCartBtn(i,t,n)},itemsSlider=e=>!!e&&(Swiper?new Swiper(e.querySelector(".swiper"),{slidesPerView:8,spaceBetween:20,breakpoints:{1730:{slidesPerView:8},1560:{slidesPerView:7},1360:{slidesPerView:6},1100:{slidesPerView:5},851:{slidesPerView:4},641:{slidesPerView:3},351:{slidesPerView:2},0:{slidesPerView:1}}}):void 0),bindPerPageSelect=e=>{if(!e||!NiceSelect)return!1;NiceSelect.bind(e)},bindSortSelect=e=>{if(!e||!NiceSelect)return!1;NiceSelect.bind(e),e.addEventListener("change",(e=>{const t=new URLSearchParams(window.location.search);t.set(e.target.getAttribute("name"),e.target.value),t.toString(),localStorage.setItem("scrollToCatalog","1"),window.location=window.location.pathname+"?"+t.toString()}))},bindFilterShowButton=e=>{if(!e)return!1;if(!e.querySelectorAll(".filter__checkbox"))return!1;const t=e.querySelector(".filter__show-more");if(!t)return!1;const n=t.innerHTML;t.addEventListener("click",(i=>{i.preventDefault(),e.classList.toggle("filter_show-all"),"свернуть"===t.innerHTML.toLowerCase()?t.innerHTML=n:t.innerHTML="Свернуть"}))},scrollToCatalog=()=>{const e=localStorage.getItem("scrollToCatalog"),t=document.querySelector(".catalog-layout");e&&t&&(t.scrollIntoView({behavior:"smooth"}),localStorage.removeItem("scrollToCatalog"))},bindFilterPrice=e=>{if(!e)return!1;const t=e.querySelector(".filter__price-slider");if(!t||!noUiSlider)return!1;noUiSlider.create(t,{start:[Number(t.getAttribute("data-min"))||0,Number(t.getAttribute("data-max"))||5e5],connect:!0,step:100,range:{min:Number(t.getAttribute("data-min"))||0,max:Number(t.getAttribute("data-max"))||5e5}});const n=e.querySelector('[name="price_from"]'),i=e.querySelector('[name="price_to"]');t.noUiSlider.on("update",(function(e,t){const o=e[t];t?i.value=Math.round(o):n.value=Math.round(o)})),n.addEventListener("change",(function(){t.noUiSlider.set([this.value,null])})),i.addEventListener("change",(function(){t.noUiSlider.set([null,this.value])}))},bindSectionsListAdaptive=e=>{if(!e)return!1;if(window.matchMedia("(max-width: 750px)").matches&&window.ADAPTIVE_SUBSECTIONS_FLAG)return!1;if(window.matchMedia("(min-width: 751px)").matches&&!window.ADAPTIVE_SUBSECTIONS_FLAG)return!1;if(window.matchMedia("(max-width: 750px)").matches&&!window.ADAPTIVE_SUBSECTIONS_FLAG){window.ADAPTIVE_SUBSECTIONS_FLAG=!0;const t=document.createElement("div");t.classList.add("sections-list-select");const n=e.querySelector("ul"),i=n.querySelector(".sections-list__item_active");i||(t.innerText="Выбрать раздел каталога"),i&&(t.append(i.cloneNode(!0)),t.querySelector("a").addEventListener("click",(e=>{e.preventDefault()})));const o=document.createElement("li");o.setAttribute("type","button"),o.classList.add("sections-list__close-btn"),n.append(o),e.after(t),t.addEventListener("click",(t=>{e.classList.toggle("sections-list_opened")})),e.addEventListener("click",(t=>{e!==t.target&&o!==t.target||e.classList.remove("sections-list_opened")}))}window.matchMedia("(min-width: 751px)").matches&&window.ADAPTIVE_SUBSECTIONS_FLAG&&(window.ADAPTIVE_SUBSECTIONS_FLAG=!1,document.querySelector(".sections-list-select")&&document.querySelector(".sections-list-select").remove())},bindFiltersAdaptive=()=>{const e=document.querySelector(".sort__filters-adaptive"),t=document.querySelector(".catalog-layout__sidebar");if(!t&&e)return e.style.display="none",!1;if(!t||!e)return!1;const n=i=>i?i.target!==e&&(i.target!==t&&!t.contains(i.target)&&(t.classList.remove("catalog-layout__sidebar_opened"),void document.removeEventListener("click",n))):(t.classList.remove("catalog-layout__sidebar_opened"),document.removeEventListener("click",n),!0);e.addEventListener("click",(e=>{e.preventDefault(),t.classList.contains("catalog-layout__sidebar_opened")?n():(t.classList.add("catalog-layout__sidebar_opened"),document.addEventListener("click",n))})),t.querySelector(".catalog-layout__sidebar-close").addEventListener("click",(e=>{e.preventDefault(),n()})),t.querySelector(".filters__actions button").addEventListener("click",(()=>{n()}))},bindFilterChange=e=>{if(!e)return!1;const t=[...e.querySelectorAll("input")],n=e.querySelector(".filters__actions button");t.map((e=>{e.addEventListener("change",(()=>{n.style.visibility="visible",n.style.opacity="1"}))})),n.addEventListener("click",(e=>{e.preventDefault(),n.style.visibility="hidden",n.style.opacity="0"}))};window.addEventListener("DOMContentLoaded",(()=>{for(const e of document.querySelectorAll(".item-card"))bindItemCard(e);for(const e of document.querySelectorAll(".items-slider"))itemsSlider(e);for(const e of document.querySelectorAll(".sort__item select"))bindSortSelect(e);scrollToCatalog();for(const e of document.querySelectorAll(".filter"))bindFilterShowButton(e);for(const e of document.querySelectorAll(".filter__price"))bindFilterPrice(e);bindSectionsListAdaptive(document.querySelector(".sections-list")),bindFiltersAdaptive(),bindFilterChange(document.querySelector(".filters")),collapseChildItems(".js-collapsible-text",{targetHeight:150,buttonMore:"Развернуть",buttonLess:"Свернуть"})})),window.addEventListener("resize",(()=>{bindSectionsListAdaptive(document.querySelector(".sections-list"))}));
//# sourceMappingURL=catalog.min.js.map
