const bindCardSlider=t=>!(!t||!t.classList.contains("swiper"))&&(Swiper?new Swiper(t,{pagination:{el:".swiper-pagination",clickable:!0}}):void 0),bindLikeBtn=(t,e)=>{if(!t||!e)return!1;const a=document.querySelector(".headerActions__btn_favorites");t.addEventListener("click",(t=>{t.preventDefault(),t.target.classList.contains("item-card__like_liked")?fetch(`/ajax/favorites.php?id=${e}&delete=Y`).then((t=>t.json())).then((e=>{if(!e.success)throw new Error("Серверная ошибка удаления товара из понравившихся");t.target.classList.remove("item-card__like_liked"),void 0!==e.count&&a&&(isNaN(e.count)||a.setAttribute("data-count",String(e.count)));if(document.querySelector(".catalog_favorites")){const e=t.target.closest(".catalog__item");e&&e.remove()}})).catch((t=>{console.log(t)})):fetch(`/ajax/favorites.php?id=${e}`).then((t=>t.json())).then((e=>{if(!e.success)throw new Error("Серверная ошибка добавления товара в понравившиеся");t.target.classList.add("item-card__like_liked"),void 0!==e.count&&a&&(isNaN(e.count)||a.setAttribute("data-count",String(e.count)))})).catch((t=>{console.log(t)}))}))},bindCompareBtn=(t,e)=>{if(!t||!e)return!1;const a=document.querySelector(".headerActions__btn_compare");t.addEventListener("click",(t=>{t.preventDefault(),t.target.classList.contains("item-card__compare_compared")?fetch(`/ajax/compare.php?id=${e}&delete=Y`).then((t=>t.json())).then((e=>{if(!e.success)throw new Error("Серверная ошибка удаления товара из сравнения");t.target.classList.remove("item-card__compare_compared"),void 0!==e.count&&a&&!isNaN(e.count)&&a.setAttribute("data-count",String(e.count))})).catch((t=>{console.log(t)})):fetch(`/ajax/compare.php?id=${e}`).then((t=>t.json())).then((e=>{if(!e.success)throw new Error("Серверная ошибка добавления товара в сравнение");t.target.classList.add("item-card__compare_compared"),void 0!==e.count&&a&&!isNaN(e.count)&&a.setAttribute("data-count",String(e.count))})).catch((t=>{console.log(t)}))}))},bindCartBtn=(t,e,a)=>{if(!t||!e)return!1;const c=document.querySelector(".headerActions__btn_basket");t.addEventListener("click",(a=>{a.preventDefault();let n=t.getAttribute("data-name"),r=t.getAttribute("data-img");console.log(n,r),a.target.classList.contains("item-card__cart_in-cart")?fetch(`/ajax/basket.php?id=${e}&delete=Y`).then((t=>t.json())).then((t=>{if(!t.success)throw new Error("Серверная ошибка удаления товара из корзины");a.target.classList.remove("item-card__cart_in-cart"),void 0!==t.count&&c&&(isNaN(t.count)||c.setAttribute("data-count",String(t.count)))})).catch((t=>{console.log(t)})):fetch(`/ajax/basket.php?id=${e}&count=1&json=1`).then((t=>t.json())).then((t=>{if(!t.success)throw new Error("Серверная ошибка добавления товара в корзину");a.target.classList.add("item-card__cart_in-cart"),Fancybox.show([{src:`<div class="modal modal_white modal_card">\n                                    <div class="modal__body modal-card">\n                                        <div class="modal-card__title">Товар добавлен в корзину</div>\n                                        <div class="modal-card__inner">\n                                            <span class="modal-card__img">\n                                                <img src="${r}" alt="">\n                                            </span>\n                                            <span class="modal-card__name">"${n}"</span>\n                                            <div class="modal-card__wrapper">\n                                                <div class="modal-card__prices">\n                                                    <div class="modal-card__price">4&nbsp;596&nbsp;₽</div>\n                                                    <div class="modal-card__price modal-card__price_old">4&nbsp;596&nbsp;₽</div>\n                                                </div>\n                                                <div class="modal-card__actions">\n                                                    <a href="/cart" class="modal-card__btn modal-card__btn_cart">В корзину</a>\n                                                    <button type="button" class="modal-card__btn modal-card__btn_close" onclick="Fancybox.close()">В каталог</button>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>`,type:"html"}]),void 0!==t.count&&c&&(isNaN(t.count)||c.setAttribute("data-count",String(t.count)))})).catch((t=>{console.log(t)}))}))},bindItemCard=t=>{if(!t)return!1;const e=t.getAttribute("data-item-id");let a;bindCardSlider(t.querySelector(".swiper")),bindLikeBtn(t.querySelector(".js-item-card-like"),e),bindCompareBtn(t.querySelector(".js-item-card-compare"),e),a=t.classList.contains("card")?document.querySelector(".page-title_card h1").innerText:t.querySelector(".item-card__name").innerText;for(const a of t.querySelectorAll(".js-item-card-cart"))bindCartBtn(a,e)},clearFavs=()=>{fetch("/ajax/favorites.php?clear=Y").then((t=>t.json())).then((t=>{t.success&&window.location.reload()}))},bindEmailForm=t=>{if(!t)return!1;const e=t.querySelector(".form__text"),a=e.innerHTML;showMessageModal("Список избранного отправлен на указанный Email.",""),t.addEventListener("submit",(c=>{c.preventDefault(),t.querySelector('[type="submit"]').setAttribute("disabled","disabled"),fetch(t.getAttribute("action"),{method:"POST",body:new FormData(t)}).then((t=>t.json())).then((({success:c})=>{c?(t.reset(),setTimeout((()=>{t.querySelector('[type="submit"]').removeAttribute("disabled")}),1e4)):(e.innerHTML="Не удалось отправить список избранного, попробуйте ещё раз.",setTimeout((()=>{e.innerHTML=a}),1e4))})).catch((()=>{e.innerHTML="Не удалось отправить список избранного, попробуйте ещё раз.",setTimeout((()=>{e.innerHTML=a}),1e4)}))}))};window.addEventListener("DOMContentLoaded",(()=>{for(const t of document.querySelectorAll(".item-card"))bindItemCard(t);for(const t of document.querySelectorAll(".js-clear-favorite"))t.addEventListener("click",clearFavs);for(const t of document.querySelectorAll(".form_send-email"))bindEmailForm(t)}));
//# sourceMappingURL=favorite.min.js.map
