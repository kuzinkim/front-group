const bindCardSlider=t=>!(!t||!t.classList.contains("swiper"))&&(Swiper?new Swiper(t,{pagination:{el:".swiper-pagination",clickable:!0}}):void 0),bindLikeBtn=(t,e)=>{if(!t||!e)return!1;const r=document.querySelector(".headerActions__btn_favorites"),a=t.closest(".item-card")&&t.closest(".item-card").querySelector(".js-item-card-cart"),c=a&&a.getAttribute("data-name")?a.getAttribute("data-name"):"",i=a&&a.getAttribute("data-img")?a.getAttribute("data-img"):"";t.addEventListener("click",(t=>{t.preventDefault(),t.target.classList.contains("item-card__like_liked")?fetch(`/ajax/favorites.php?id=${e}&delete=Y`).then((t=>t.json())).then((e=>{if(!e.success)throw new Error("Серверная ошибка удаления товара из понравившихся");t.target.classList.remove("item-card__like_liked"),void 0!==e.count&&r&&(isNaN(e.count)||r.setAttribute("data-count",String(e.count)));if(document.querySelector(".catalog_favorites")){const e=t.target.closest(".catalog__item");e&&e.remove()}})).catch((t=>{console.log(t)})):fetch(`/ajax/favorites.php?id=${e}`).then((t=>t.json())).then((e=>{if(!e.success)throw new Error("Серверная ошибка добавления товара в понравившиеся");t.target.classList.add("item-card__like_liked"),showAddItemModal("Товар добавлен в избранное",{name:c,img:i},"/favorites/","В избранное"),void 0!==e.count&&r&&(isNaN(e.count)||r.setAttribute("data-count",String(e.count)))})).catch((t=>{console.log(t)}))}))},bindCompareBtn=(t,e)=>{if(!t||!e)return!1;const r=document.querySelector(".headerActions__btn_compare"),a=t.closest(".item-card")&&t.closest(".item-card").querySelector(".js-item-card-cart"),c=a&&a.getAttribute("data-name")?a.getAttribute("data-name"):"",i=a&&a.getAttribute("data-img")?a.getAttribute("data-img"):"";t.addEventListener("click",(t=>{t.preventDefault(),t.target.classList.contains("item-card__compare_compared")?fetch(`/ajax/compare.php?id=${e}&delete=Y`).then((t=>t.json())).then((e=>{if(!e.success)throw new Error("Серверная ошибка удаления товара из сравнения");t.target.classList.remove("item-card__compare_compared"),void 0!==e.count&&r&&!isNaN(e.count)&&r.setAttribute("data-count",String(e.count))})).catch((t=>{console.log(t)})):fetch(`/ajax/compare.php?id=${e}`).then((t=>t.json())).then((e=>{if(!e.success)throw new Error("Серверная ошибка добавления товара в сравнение");t.target.classList.add("item-card__compare_compared"),showAddItemModal("Товар добавлен в сравнение",{name:c,img:i},"/compare/","В сравнение"),void 0!==e.count&&r&&!isNaN(e.count)&&r.setAttribute("data-count",String(e.count))})).catch((t=>{console.log(t)}))}))},bindCartBtn=(t,e,r)=>{if(!t||!e)return!1;const a=document.querySelector(".headerActions__btn_basket");t.addEventListener("click",(r=>{r.preventDefault();let c=t.getAttribute("data-name"),i=t.getAttribute("data-img");r.target.classList.contains("item-card__cart_in-cart")?fetch(`/ajax/basket.php?id=${e}&delete=Y`).then((t=>t.json())).then((t=>{if(!t.success)throw new Error("Серверная ошибка удаления товара из корзины");r.target.classList.remove("item-card__cart_in-cart"),void 0!==t.count&&a&&(isNaN(t.count)||a.setAttribute("data-count",String(t.count)))})).catch((t=>{console.log(t)})):fetch(`/ajax/basket.php?id=${e}&count=1&json=1`).then((t=>t.json())).then((t=>{if(!t.success)throw new Error("Серверная ошибка добавления товара в корзину");r.target.classList.add("item-card__cart_in-cart"),showAddItemModal("Товар добавлен в корзину",{name:c,img:i},"/basket/","В корзину"),void 0!==t.count&&a&&(isNaN(t.count)||a.setAttribute("data-count",String(t.count)))})).catch((t=>{console.log(t)}))}))},bindItemCard=t=>{if(!t)return!1;const e=t.getAttribute("data-item-id");let r;bindCardSlider(t.querySelector(".swiper")),bindLikeBtn(t.querySelector(".js-item-card-like"),e),bindCompareBtn(t.querySelector(".js-item-card-compare"),e),r=t.classList.contains("card")?document.querySelector(".page-title_card h1").innerText:t.querySelector(".item-card__name").innerText;for(const r of t.querySelectorAll(".js-item-card-cart"))bindCartBtn(r,e)},clearFavs=()=>{fetch("/ajax/favorites.php?clear=Y").then((t=>t.json())).then((t=>{t.success&&window.location.reload()}))},bindEmailForm=t=>{if(!t)return!1;const e=t.querySelector(".form__text"),r=e.innerHTML;t.addEventListener("submit",(a=>{a.preventDefault(),t.querySelector('[type="submit"]').setAttribute("disabled","disabled"),fetch(t.getAttribute("action"),{method:"POST",body:new FormData(t)}).then((t=>t.json())).then((({success:a})=>{a?(showMessageModal("Список избранного отправлен на указанный Email.",""),t.reset(),setTimeout((()=>{t.querySelector('[type="submit"]').removeAttribute("disabled")}),1e4)):(e.innerHTML="Не удалось отправить список избранного, попробуйте ещё раз.",setTimeout((()=>{e.innerHTML=r}),1e4))})).catch((()=>{e.innerHTML="Не удалось отправить список избранного, попробуйте ещё раз.",setTimeout((()=>{e.innerHTML=r}),1e4)}))}))};window.addEventListener("DOMContentLoaded",(()=>{for(const t of document.querySelectorAll(".item-card"))bindItemCard(t);for(const t of document.querySelectorAll(".js-clear-favorite"))t.addEventListener("click",clearFavs);for(const t of document.querySelectorAll(".form_send-email"))bindEmailForm(t)}));