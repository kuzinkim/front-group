const bindCardSlider=t=>!(!t||!t.classList.contains("swiper"))&&(Swiper?new Swiper(t,{pagination:{el:".swiper-pagination",clickable:!0}}):void 0),bindLikeBtn=(t,e)=>{if(!t||!e)return!1;const n=document.querySelector(".headerActions__btn_favorites");t.addEventListener("click",(t=>{t.preventDefault(),t.target.classList.contains("item-card__like_liked")?fetch(`/ajax/favorites.php?id=${e}&delete=Y`).then((t=>t.json())).then((e=>{if(!e.success)throw new Error("Серверная ошибка удаления товара из понравившихся");t.target.classList.remove("item-card__like_liked"),void 0!==e.count&&n&&(isNaN(e.count)||n.setAttribute("data-count",String(e.count)));if(document.querySelector(".catalog_favorites")){const e=t.target.closest(".catalog__item");e&&e.remove()}})).catch((t=>{console.log(t)})):fetch(`/ajax/favorites.php?id=${e}`).then((t=>t.json())).then((e=>{if(!e.success)throw new Error("Серверная ошибка добавления товара в понравившиеся");t.target.classList.add("item-card__like_liked"),void 0!==e.count&&n&&(isNaN(e.count)||n.setAttribute("data-count",String(e.count)))})).catch((t=>{console.log(t)}))}))},bindCompareBtn=(t,e)=>{if(!t||!e)return!1;const n=document.querySelector(".headerActions__btn_compare");t.addEventListener("click",(t=>{t.preventDefault(),t.target.classList.contains("item-card__compare_compared")?fetch(`/ajax/compare.php?id=${e}&delete=Y`).then((t=>t.json())).then((e=>{if(!e.success)throw new Error("Серверная ошибка удаления товара из сравнения");t.target.classList.remove("item-card__compare_compared"),void 0!==e.count&&n&&!isNaN(e.count)&&n.setAttribute("data-count",String(e.count))})).catch((t=>{console.log(t)})):fetch(`/ajax/compare.php?id=${e}`).then((t=>t.json())).then((e=>{if(!e.success)throw new Error("Серверная ошибка добавления товара в сравнение");t.target.classList.add("item-card__compare_compared"),void 0!==e.count&&n&&!isNaN(e.count)&&n.setAttribute("data-count",String(e.count))})).catch((t=>{console.log(t)}))}))},bindCartBtn=(t,e,n)=>{if(!t||!e)return!1;const r=document.querySelector(".headerActions__btn_basket");t.addEventListener("click",(t=>{t.preventDefault(),t.target.classList.contains("item-card__cart_in-cart")?fetch(`/ajax/basket.php?id=${e}&delete=Y`).then((t=>t.json())).then((e=>{if(!e.success)throw new Error("Серверная ошибка удаления товара из корзины");t.target.classList.remove("item-card__cart_in-cart"),void 0!==e.count&&r&&(isNaN(e.count)||r.setAttribute("data-count",String(e.count)))})).catch((t=>{console.log(t)})):fetch(`/ajax/basket.php?id=${e}&count=1&json=1`).then((t=>t.json())).then((e=>{if(!e.success)throw new Error("Серверная ошибка добавления товара в корзину");t.target.classList.add("item-card__cart_in-cart"),Fancybox.show([{src:`<div class="modal-cart-confirmation">\n<div>Товар <b>"${n}"</b> добавлен в корзину.</div>\n<div class="modal-cart-confirmation__buttons">\n<a href="/basket/">Перейти в корзину</a>\n<div class="is-close-btn" onclick="Fancybox.close()">Продолжить покупки</div>\n</div>\n</div>`,type:"html"}]),void 0!==e.count&&r&&(isNaN(e.count)||r.setAttribute("data-count",String(e.count)))})).catch((t=>{console.log(t)}))}))},bindItemCard=t=>{if(!t)return!1;const e=t.getAttribute("data-item-id");let n;bindCardSlider(t.querySelector(".swiper")),bindLikeBtn(t.querySelector(".js-item-card-like"),e),bindCompareBtn(t.querySelector(".js-item-card-compare"),e),n=t.classList.contains("card")?document.querySelector(".page-title_card h1").innerText:t.querySelector(".item-card__name").innerText;for(const r of t.querySelectorAll(".js-item-card-cart"))bindCartBtn(r,e,n)},clearFavs=()=>{fetch("/ajax/favorites.php?clear=Y").then((t=>{t.json()})).then((t=>{t.success&&window.location.reload()}))},bindEmailForm=t=>{if(!t)return!1;const e=t.querySelector(".form__text"),n=e.innerHTML;t.addEventListener("submit",(r=>{r.preventDefault(),fetch(t.getAttribute("action"),{method:"POST",body:new FormData(t)}).then((t=>t.json())).then((({success:r})=>{r?(e.innerHTML="Список избранного отправлен.",t.querySelector('[type="submit"]').setAttribute("disabled","disabled"),setTimeout((()=>{e.innerHTML=n,Fancybox&&Fancybox.close(!0),t.querySelector('[type="submit"]').removeAttribute("disabled")}),1e4),t.reset()):(e.innerHTML="Не удалось отправить список избранного, попробуйте ещё раз.",setTimeout((()=>{e.innerHTML=n}),1e4))})).catch((()=>{e.innerHTML="Не удалось отправить список избранного, попробуйте ещё раз.",setTimeout((()=>{e.innerHTML=n}),1e4)}))}))};window.addEventListener("DOMContentLoaded",(()=>{for(const t of document.querySelectorAll(".item-card"))bindItemCard(t);for(const t of document.querySelectorAll(".js-clear-favorite"))t.addEventListener("click",clearFavs);for(const t of document.querySelectorAll(".form_send-email"))bindEmailForm(t)}));