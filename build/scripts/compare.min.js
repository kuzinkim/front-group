const bindCompareItemsSlider=(e,t)=>{if(!e)return!1;const o=e.parentElement.querySelector(".compare-section__control_prev"),c=e.parentElement.querySelector(".compare-section__control_next"),a=e.parentElement.querySelector(".compare-section__pagination"),n=new Swiper(e,{navigation:{prevEl:o,nextEl:c},pagination:{el:a,type:"fraction"},breakpoints:{1501:{slidesPerView:5},1251:{slidesPerView:4},1001:{slidesPerView:3},0:{slidesPerView:1}}});bindButtons(e);const r=e=>{const t=e.cloneNode(!0);t.classList.add("compare-section__items-slider_clone"),bindButtons(t),e.after(t);const o=t.querySelector(".compare-section__control_prev"),c=t.querySelector(".compare-section__control_next"),a=t.querySelector(".compare-section__pagination");return new Swiper(t.querySelector(".swiper"),{navigation:{prevEl:o,nextEl:c},slidesPerView:1,initialSlide:1,pagination:{el:a,type:"fraction"}})};if(window[`COMPARE_ADAPTIVE_${t}`]=!1,window.matchMedia("(max-width: 1000px)").matches){const t=r(e.parentElement);createAdaptiveStickyHeader(e.parentElement.parentElement,n,t)}window.addEventListener("resize",(()=>{if(!window[`COMPARE_ADAPTIVE_${t}`]&&window.matchMedia("(max-width: 1000px)").matches){const o=r(e.parentElement);createAdaptiveStickyHeader(e.parentElement.parentElement,n,o),window[`COMPARE_ADAPTIVE_${t}`]=!0}if(window[`COMPARE_ADAPTIVE_${t}`]&&window.matchMedia("(min-width: 1001px)").matches){const e=[...document.querySelectorAll(".compare-section__items-slider_clone")];e.length&&e.map((e=>{e.remove()}));const o=[...document.querySelectorAll(".mobile-sticky-header")];o.length&&o.map((e=>{e.remove()})),window[`COMPARE_ADAPTIVE_${t}`]=!1}}))},updateSizes=()=>{const e=[...document.querySelectorAll(".compare__section_active .compare-item")],t=[...document.querySelectorAll(".compare__section_active .compare-title-column__row_char")],o=[];if(e.map((e=>{[...e.querySelectorAll(".compare-item__char")].map(((e,t)=>o[t]?o[t]<e.offsetHeight&&(o[t]=Math.ceil(e.scrollHeight),!1):(o.push(Math.ceil(e.scrollHeight)),!1)))})),console.log(o),t.map(((e,t)=>{e.style.height=o[t]+"px"})),e.map((e=>{[...e.querySelectorAll(".compare-item__char")].map(((e,t)=>{e.style.height=o[t]+"px"}))})),window.matchMedia("(max-width: 720px)").matches){const e=document.querySelector(".compare__section_active").getBoundingClientRect().top+window.scrollY;[...document.querySelector(".compare__section_active .compare-item").querySelectorAll(".compare-item__char")].map(((o,c)=>{const a=o.getBoundingClientRect().top+window.scrollY-e;t[c].style.top=a-20+"px"}))}},bindCompareTabs=e=>{if(!e)return!1;const t=[...e.querySelectorAll(".compare__tab-button")];if(!t.length)return!1;t.map((t=>{t.addEventListener("click",(o=>{o.preventDefault();const c=document.querySelector(t.getAttribute("href"));if(!c)return!1;const a=e.querySelector(".compare__tab-button_active"),n=document.querySelector(".compare__section_active");a&&a.classList.remove("compare__tab-button_active"),n&&n.classList.remove("compare__section_active"),t.classList.add("compare__tab-button_active"),t.scrollIntoView({behavior:"smooth"}),c.classList.add("compare__section_active"),setTimeout((()=>{updateSizes()}),100)}))}))},createAdaptiveStickyHeader=(e,t,o)=>{const c=document.createElement("div");c.classList.add("mobile-sticky-header");const a=document.createElement("div");a.classList.add("container"),c.append(a);const n=(e,t,o=0)=>{const c=document.createElement("div");c.classList.add("swiper");const n=document.createElement("div");n.classList.add("swiper-wrapper");const r=document.createElement("div");r.classList.add("mobile-sticky-header__pagination"),c.append(r);const i=document.createElement("button");i.setAttribute("type","button"),i.classList.add("mobile-sticky-header__control"),i.classList.add("mobile-sticky-header__control_prev"),c.append(i);const s=document.createElement("button");s.setAttribute("type","button"),s.classList.add("mobile-sticky-header__control"),s.classList.add("mobile-sticky-header__control_next"),c.append(s),[...t].map((e=>{const t=document.createElement("div");t.classList.add("swiper-slide"),t.append(e.querySelector(".compare-item__name").cloneNode(!0)),t.setAttribute("data-item-id",e.querySelector(".compare-item").getAttribute("data-item-id"));const o=document.createElement("button");o.classList.add("compare-item__to-cart"),o.setAttribute("type","button"),o.innerText="В корзину",o.addEventListener("click",(e=>{e.preventDefault(),addToCart(o)})),t.append(o),n.append(t)})),c.append(n),a.append(c),new Swiper(c,{slidesPerView:1,controller:{control:e},pagination:{el:r,type:"fraction"},initialSlide:o,navigation:{prevEl:i,nextEl:s}})};n(t,t.el.querySelectorAll(".swiper-slide"),0),n(o,t.el.querySelectorAll(".swiper-slide"),1),e.append(c),window.addEventListener("scroll",(()=>{const e=document.querySelector(".compare__section_active .compare-item__char"),t=document.querySelector(".compare__section_active .mobile-sticky-header");if(window.matchMedia("(min-width: 1001px)").matches)return!1;e&&t&&(e.getBoundingClientRect().top<70&&!t.classList.contains("mobile-sticky-header_show")?t.classList.add("mobile-sticky-header_show"):e.getBoundingClientRect().top>=70&&t.classList.remove("mobile-sticky-header_show"))}))},clearSection=e=>{if(!e)return!1;const t=e.closest(".compare-section")&&e.closest(".compare-section").getAttribute("data-category-id");if(!t)return!1;fetch(`/ajax/compare.php?section=${t}`).then((e=>e.json())).then((({success:e})=>{if(!e)throw new Error("Серверная ошибка удаления.");window.location.reload()})).catch((e=>{console.warn(e.message)}))},clearAll=()=>{fetch("/ajax/compare.php?clear=Y").then((e=>e.json())).then((({success:e})=>{if(!e)throw new Error("Серверная ошибка очистки.");window.location.reload()})).catch((e=>{console.warn(e)}))},deleteCompareItem=e=>{if(!e)return!1;const t=e.closest(".compare-item")&&e.closest(".compare-item").getAttribute("data-item-id");if(!t)return!1;fetch(`/ajax/compare.php?id=${t}&delete=Y`).then((e=>e.json())).then((e=>{if(!e.success)throw new Error("Серверная ошибка удаления товара из сравнения");window.location.reload()})).catch((e=>{console.log(e)}))},addToCart=e=>{if(!e)return!1;const t=e.closest(".compare-item")&&e.closest(".compare-item").getAttribute("data-item-id")||e.closest(".swiper-slide")&&e.closest(".swiper-slide").getAttribute("data-item-id");if(!t)return!1;const o=document.querySelector(".headerActions__btn_basket");let c=e.getAttribute("data-name"),a=e.getAttribute("data-img");e.classList.contains("compare-item__to-cart_in-cart")?fetch(`/ajax/basket.php?id=${t}&delete=Y`).then((e=>e.json())).then((t=>{if(!t.success)throw new Error("Серверная ошибка удаления товара из корзины");e.classList.remove("compare-item__to-cart_in-cart"),void 0!==t.count&&o&&(isNaN(t.count)||o.setAttribute("data-count",String(t.count))),e.innerText("В корзину")})).catch((e=>{console.log(e)})):fetch(`/ajax/basket.php?id=${t}&count=1&json=1`).then((e=>e.json())).then((t=>{if(!t.success)throw new Error("Серверная ошибка добавления товара в корзину");e.classList.add("compare-item__to-cart_in-cart"),Fancybox.show([{src:`<div class="modal modal_white modal_card">\n                        <div class="modal__body modal-card">\n                            <div class="modal-card__title">Товар добавлен в корзину</div>\n                            <div class="modal-card__inner">\n                                <span class="modal-card__img">\n                                    <img src="${a}" alt="">\n                                </span>\n                                <span class="modal-card__name">"${c}"</span>\n                                <div class="modal-card__wrapper">\n                                    <div class="modal-card__actions">\n                                        <a href="/cart" class="modal-card__btn modal-card__btn_cart">В корзину</a>\n                                        <button type="button" class="modal-card__btn modal-card__btn_close" onclick="Fancybox.close()">В каталог</button>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>`,type:"html"}]),e.innerText("В корзине"),void 0!==t.count&&o&&(isNaN(t.count)||o.setAttribute("data-count",String(t.count)))})).catch((e=>{console.log(e)}))},bindButtons=e=>{for(const t of e.querySelectorAll(".compare-item__to-cart"))t.addEventListener("click",(e=>{e.preventDefault(),addToCart(t)}));for(const t of e.querySelectorAll(".compare-item__del"))t.addEventListener("click",(e=>{e.preventDefault(),deleteCompareItem(t)}))};window.addEventListener("DOMContentLoaded",(()=>{const e=[...document.querySelectorAll(".compare-section__items-slider .swiper")];e.length&&e.map(((e,t)=>{bindCompareItemsSlider(e,t)})),bindCompareTabs(document.querySelector(".compare__toggles"));for(const e of document.querySelectorAll(".compare-section__remove-section"))e.addEventListener("click",(t=>{t.preventDefault(),clearSection(e)}));for(const e of document.querySelectorAll(".compare__clear"))e.addEventListener("click",(e=>{e.preventDefault(),clearAll()}));updateSizes()})),window.addEventListener("resize",updateSizes);