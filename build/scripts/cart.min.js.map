{"version":3,"file":"cart.min.js","names":["bindAddressToggle","radioNode","stockRadioNode","inputWrapperNode","inputNode","querySelector","addEventListener","e","target","checked","classList","remove","setAttribute","add","removeAttribute","bindItemCounter","itemNode","input","incBtn","decBtn","preventDefault","value","Number","isNaN","String","countItemSumPrice","calcOverall","sumNode","document","sum","querySelectorAll","map","el","innerText","replace","reduce","acc","item","Intl","NumberFormat","style","currency","maximumFractionDigits","format","initial","price","multiplier","priceNode","countNode","checkEmpty","wrapper","length","display","emptyNode","createElement","innerHTML","append","bindDeleteItem","btnDel","itemId","getAttribute","fetch","method","body","JSON","stringify","then","resp","json","status","Error","catch","mess","Fancybox","show","src","type","clearCart","bindCartItem","collectItemsData","items","id","name","count","collectData","formNode","bindCartForm","console","log","cache","headers","number","mail","reset","window","phoneInput","Inputmask","mask","showMaskOnHover"],"sources":["cart.js"],"sourcesContent":["const bindAddressToggle = (radioNode, stockRadioNode, inputWrapperNode) => {\n    if (!radioNode || !inputWrapperNode || !stockRadioNode) {\n        return false;\n    }\n\n    const inputNode = inputWrapperNode.querySelector('input');\n\n    if (!inputNode) {\n        return false;\n    }\n\n    radioNode.addEventListener('change', (e) => {\n        if (e.target.checked) {\n            inputWrapperNode.classList.remove('form__item_hidden');\n            inputNode.setAttribute('required', 'required');\n        }\n    })\n\n    stockRadioNode.addEventListener('change', (e) => {\n        if (e.target.checked) {\n            inputWrapperNode.classList.add('form__item_hidden');\n            inputNode.removeAttribute('required');\n        }\n    })\n}\n\nconst bindItemCounter = (itemNode) => {\n    if (!itemNode) {\n        return false;\n    }\n\n    const input = itemNode.querySelector('.cart-table__item-count input');\n    const incBtn = itemNode.querySelector('.cart-table__item-count button[data-action=\"increment\"]');\n    const decBtn = itemNode.querySelector('.cart-table__item-count button[data-action=\"decrement\"]');\n\n    if (!input || !incBtn || !decBtn) {\n        return false;\n    }\n\n    incBtn.addEventListener('click', (e) => {\n        e.preventDefault();\n\n        const value = Number(input.value);\n\n        if (isNaN(value)) {\n            input.value = '1';\n            return true;\n        }\n\n        input.value = String(value + 1);\n\n        countItemSumPrice(itemNode)\n    })\n\n    decBtn.addEventListener('click', (e) => {\n        e.preventDefault();\n\n        const value = Number(input.value);\n\n        if (value === 1 || isNaN(value)) {\n            input.value = '1';\n            return true;\n        }\n\n        input.value = String(value - 1);\n\n        countItemSumPrice(itemNode)\n    })\n}\n\nconst calcOverall = () => {\n\n    const sumNode = document.querySelector('.cart-table__summary-value');\n\n    if (!sumNode) {\n        return false;\n    }\n\n    const priceNodes = [...document.querySelectorAll('.cart-table__item-sum')];\n\n    const prices = priceNodes.map((el) => Number(el.innerText.replace(/\\D/g, '')))\n\n    const sum = prices.reduce((acc, item) => {\n        if (typeof item === \"number\") {\n            return acc + item;\n        }\n        return acc;\n    }, 0)\n\n    sumNode.innerText = new Intl.NumberFormat('ru-RU', {\n        style: 'currency',\n        currency: 'RUB',\n        maximumFractionDigits: 0\n    }).format(\n        sum,\n    )\n\n}\n\nconst countItemSumPrice = (itemNode, initial) => {\n    if (!itemNode) {\n        return false;\n    }\n\n    let sum = undefined;\n    let price = undefined;\n    let multiplier = undefined;\n\n    const priceNode = itemNode.querySelector('.cart-table__item-price span');\n\n    if (!priceNode) {\n        sum = 'По запросу';\n    } else {\n        price = Number(priceNode.innerText.replace(/\\D/g, ''));\n    }\n\n    if (!price || isNaN(price)) {\n        sum = 'По запросу';\n    }\n\n    const countNode = itemNode.querySelector('.cart-table__item-count input');\n\n    if (!countNode) {\n        sum = 'По запросу';\n    } else {\n        multiplier = Number(countNode.value);\n    }\n\n    if (!multiplier || isNaN(multiplier)) {\n        sum = 'По запросу';\n    }\n\n    if (!sum) {\n        sum = new Intl.NumberFormat('ru-RU', {style: 'currency', currency: 'RUB', maximumFractionDigits: 0}).format(\n            price * multiplier,\n        )\n    }\n\n    const sumNode = itemNode.querySelector('.cart-table__item-sum');\n\n    if (sumNode) {\n        sumNode.innerText = sum;\n    }\n\n    if (!initial) {\n        calcOverall();\n    }\n}\n\nconst checkEmpty = () => {\n    //<div className=\"cart__empty\">В корзине пусто. <a href=\"/catalog/\">Перейти в каталог</a>.</div>\n\n    const wrapper = document.querySelector('.cart__table-wrapper');\n\n    if (!wrapper) {\n        return false;\n    }\n\n    const items = document.querySelectorAll('.cart-table__item');\n\n    if (!items.length) {\n        wrapper.querySelector('.cart-table').style.display = 'none';\n        const emptyNode = document.createElement('div');\n        emptyNode.classList.add('cart__empty');\n        emptyNode.innerHTML = 'В корзине пусто. <a href=\"/catalog/\">Перейти в каталог</a>.';\n        wrapper.append(emptyNode);\n    }\n}\n\nconst bindDeleteItem = (itemNode) => {\n    if (!itemNode) {\n        return false;\n    }\n\n    const btnDel = itemNode.querySelector('.cart-table__item-del');\n\n    const itemId = itemNode.getAttribute('data-item-id');\n\n    btnDel.addEventListener('click', (e) => {\n        e.preventDefault();\n\n        fetch('path/to/delete/item', {\n            method: 'POST',\n            body: JSON.stringify({\n                itemId: itemId\n            })\n        }).then((resp) => resp.json())\n            .then(({status}) => {\n                if (status === 'success') {\n                    itemNode.remove();\n                    calcOverall();\n                    checkEmpty();\n                } else {\n                    throw new Error()\n                }\n            }).catch((mess) => {\n\n            Fancybox.show([\n                {\n                    src: `<div class=\"modal-cart-confirmation\">\n<div>Ошибка удаления товара из корзины. Вы можете оформить заказ и отредактировать его содержимое, когда наш менеджер свяжется с Вами.</div>\n<div class=\"modal-cart-confirmation__buttons\">\n<a onclick=\"window.location.reload()\">Обновить страницу</a>\n<div class=\"is-close-btn\" onclick=\"Fancybox.close()\">Продолжить</div>\n</div>\n</div>`,\n                    type: \"html\",\n                }])\n\n        })\n\n        // todo удалить, когда заработает бэк\n        itemNode.remove();\n        calcOverall();\n        checkEmpty();\n    })\n}\n\nconst clearCart = () => {\n    for (const item of document.querySelectorAll('.cart-table__item')) {\n        item.remove();\n    }\n\n    checkEmpty();\n}\n\nconst bindCartItem = (itemNode) => {\n    if (!itemNode) {\n        return false;\n    }\n\n    countItemSumPrice(itemNode, true)\n\n    bindItemCounter(itemNode);\n\n    calcOverall();\n\n    bindDeleteItem(itemNode);\n}\n\nconst collectItemsData = () => {\n    const items = [...document.querySelectorAll('.cart-table__item')];\n\n    if (!items.length) {\n        return []\n    }\n\n    return items.reduce((acc, item) => {\n\n        const obj = {\n            id: item.getAttribute('data-item-id'),\n            name: item.querySelector('.cart-table__item-name').innerText,\n            count: item.querySelector('.cart-table__item-count input').value,\n        };\n\n        return [...acc, obj];\n    }, [])\n\n}\n\nconst collectData = (formNode) => {\n\n    const inputs = [...formNode.querySelectorAll('input:not([type=\"submit\"])')];\n\n    const data = inputs.reduce((acc, input) => {\n\n        if (input.getAttribute('type') === 'radio') {\n            if (input.checked) {\n                return {\n                    ...acc,\n                    [input.getAttribute('name')]: input.value,\n                }\n            }\n\n            return acc;\n        }\n\n        return {\n            ...acc,\n            [input.getAttribute('name')]: input.value,\n        }\n    }, {})\n\n    return {\n        ...data,\n\n        items: collectItemsData(),\n    }\n}\n\nconst bindCartForm = (formNode) => {\n    if (!formNode) {\n        return false;\n    }\n\n    formNode.addEventListener('submit', (e) => {\n        e.preventDefault();\n\n\n        console.log(collectData(formNode))\n\n        fetch('path', {\n            method: \"POST\",\n            cache: \"no-cache\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify(collectData(formNode))\n        })\n            .then((resp) => resp.json())\n            .then(({status, number, mail}) => {\n                if (status === 'success') {\n                    Fancybox.show([\n                        {\n                            src: `<div class=\"modal-cart-confirmation\">\n<div class=\"modal-cart-confirmation__text\">Оформлен заказ №${number}. Детали заказа отправлены на электронную почту ${mail}. В ближайшее время наш менеджер свяжется с Вами.</div>\n<div class=\"modal-cart-confirmation__buttons\">\n<a href=\"/catalog/\">Перейти в каталог</a>\n</div>\n</div>`,\n                            type: \"html\",\n                        }]);\n                    formNode.reset();\n                    clearCart();\n\n                } else {\n                    throw new Error()\n                }\n            }).catch(() => {\n            Fancybox.show([\n                {\n                    src: `<div class=\"modal-cart-confirmation\">\n<div class=\"modal-cart-confirmation__text\">Произошла ошибка при оформлении заказа.<br>Попробуйте еще раз, или свяжитесь с нами по телефону <a href=\"tel:+74959882028\">+7(495) 988-20-28</a></div>\n<div class=\"modal-cart-confirmation__buttons\">\n<a onclick=\"window.location.reload()\">Обновить страницу</a>\n<div class=\"is-close-btn\" onclick=\"Fancybox.close()\">Продолжить</div>\n</div>\n</div>`,\n                    type: \"html\",\n                }])\n        })\n    })\n}\n\n\nwindow.addEventListener('DOMContentLoaded', () => {\n    bindAddressToggle(\n        document.querySelector('.js-address-radio'),\n        document.querySelector('.js-stock-radio'),\n        document.querySelector('.js-address-field'))\n\n    for (const itemNode of document.querySelectorAll('.cart-table__item')) {\n        bindCartItem(itemNode)\n    }\n\n    checkEmpty();\n\n    bindCartForm(document.querySelector('.js-cart-form'))\n\n    for (const phoneInput of document.querySelectorAll('input[type=\"tel\"]')) {\n        if (!!Inputmask) {\n            Inputmask({\"mask\": ['+7 999 999-99-99', '8 999 999-99-99'], showMaskOnHover: false,}).mask(phoneInput);\n        }\n    }\n\n})"],"mappings":"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"}